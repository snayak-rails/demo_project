<div class="container-fluid">
  <h3>Cart</h3>

  <%= render partial: 'products/modal_login' %>

<% @cart_items.each do |cart_item| %>
  <% product = Product.find(cart_item.product_id) %>
  <div class="card">
    <div class="card-body">
      <h5 class="card-title"><%= product.title %></h5>
      <div id="<%= cart_item.id %>-price">
        Price: <%= number_to_currency(product.price * cart_item.quantity, unit: "$")%>
      </div>
      <div id="<%= cart_item.id %>" class="d-inline-block">
        Quantity: <%= cart_item.quantity %>
      </div>
      <div id="<%= cart_item.id %>-save" class="d-inline-block">
        <%= form_tag(update_cart_item_quantity_cart_checkout_path(cart_item.id),
          method: :put, remote: true) do %>
        <%= number_field_tag :updated_quantity, nil, required: true %>
        <%= submit_tag 'Save', class: "btn btn-success" %>
        <% end %>
      </div>
      <div>
          <%= button_to "Remove item",
          destroy_cart_item_cart_checkout_path(cart_item.id),
          id: "remove-cart-item-button", method: :delete, class: "btn btn-danger" %>
      </div>
    </div>
  </div>
<% end %><br>

<div id='total-amount'>
  Total Amount: <%= number_to_currency(@total_amount, unit: "$") %><br>
</div>

<br>
<div id='flash'>
  <%= render partial: 'shared/flash',
  locals: {message: flash[:notice]} unless flash[:notice].blank? %>
</div>

<%= button_to "Purchase", purchase_cart_checkout_index_path, class: "btn btn-primary",
    :id => "purchase-cart-button", :method => :get, remote: true %>

<div id='purchase-form' ></div><br>
<% if current_user %>
  <%= button_to "Order history", order_history_cart_checkout_index_path,
    :id => "order-history-button", :method => :get, class: "btn btn-info" %><br>
<% end %>

</div>

